<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="draft">
	
	<resultMap type="mybatis.vo.DraftVO" id="draftMap">
		<association property="evo" javaType="mybatis.vo.EmpVO" select="emp" column="e_code" />
	</resultMap>
	
	<select id="emp" parameterType="String" resultType="mybatis.vo.EmpVO">
		select * from emp_t
		where e_code = #{e_code}
	</select>
	
	<!-- 기안리스트 및 검색시 리스트 -->
	<select id="draftList" parameterType="java.util.Map" resultMap="draftMap">
		select * from drafting_paper_t
		where draft_status = '0'
		<if test="draftSearch != null">
			and draft_title like '%'||#{draftSearch}||'%'
		</if>
		<if test="draft_write_year != null">
			and draft_year <![CDATA[ <= ]]> #{draft_write_year}
		</if>
		
	</select>
	
	<!-- 기안등록 -->
	<insert id="draftWrite" parameterType="mybatis.vo.DraftVO">
		insert into drafting_paper_t(draft_code,e_code,draft_year,draft_title,draft_content,draft_file_name,draft_ori_name,draft_status)
		values( 'DC' || TO_CHAR(draft_seq.NEXTVAL),#{e_code},sysdate,#{draft_title},#{draft_content},#{draft_file_name},#{draft_ori_name},'0')
	</insert>
	
	<!-- 기안작성자 e_code를 가져와 쓴글의 문서번호(draft_code)를 가져온다. -->
	<select id="getDraftCode" parameterType="String" resultType="mybatis.vo.DraftVO">
		select * from drafting_paper_t where draft_code = 
		(select draft_code from (select * from drafting_paper_t order by draft_year desc) where e_code = 
		#{e_code} and rownum = 1 )
	</select>
	
</mapper>
